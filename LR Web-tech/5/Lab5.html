<html>
<head>
<title>
Задание 1. Салихов Р.Н.
</title>
<style>
body{background:#75c1ff;}
.rotD{
	transform: rotate(90deg);
}
.rotU{
	transform: rotate(270deg);
}
.rotL{
	transform: scale(-1, 1);
}
</style>
</head>
<body style="margin:0;">
<!--<input type="button" id="go" value="go">-->
<div>
<img id="cat" src="../../img/pacman.gif" class="rotated" style="position:relative"><br>
</div>
<script src="../../lib/jquery-3.6.0.min.js"></script>
<script src="../../lib/jquery-ui-1.13.1.custom/jquery-ui.js"></script> 
<script>
var map = [
[1,1,1,1,1,1,1],
[1,0,0,0,0,1,1],
[1,1,1,0,1,1,1],
[1,0,0,0,1,1,1],
[1,0,1,1,1,1,1],
[1,0,0,0,0,2,1],
[1,1,1,1,1,1,1]
];
console.log(map.length);
console.log(map[0].length);
var movm = 0; //Куда двигается. 1-вверх, 2-вниз, 3-влево, 4-вправо
var winh = $(window).height(); //Высота окна
var winw = $(window).width(); //Ширина окна
$(document).ready(function(){
	
	for (let i=0;i<map.length;i++){
		for (let j=0;j<map[0].length;j++){
			switch(map[i][j]){
				case 0:$("<img src='../../img/floor.jpg' style='position:static'>").appendTo("div");break;
				case 1:$("<img src='../../img/wall.jpg' style='position:static'>").appendTo("div");break;
				case 2:$("<img src='../../img/floor.jpg' style='position:static'>").appendTo("div");
					$("#cat")[0].style.top=32*(i+1);$("#cat")[0].style.right=(-32*j);break;
			}
		}
		$("<br>").appendTo("div");
	}
	
	$("#go").click(function (){
		if (movm == 0){
		 movm = 4;
		 mbwall(4);
		}
		else{movm = 0;}
	});
	
	$(document).keyup(function(k){
		if (k.key=="ArrowUp" || k.keyCode==38){
			$("#cat").removeClass();
			$("#cat").addClass('rotU');
			movm = 1;
			mbwall(1);
		}
		if (k.key=="ArrowDown" || k.keyCode==40){
			$("#cat").removeClass();
			$("#cat").addClass('rotD');
			movm = 2;
			mbwall(2);
		}
		if (k.key=="ArrowLeft" || k.keyCode==37){
			$("#cat").removeClass();
			$("#cat").addClass('rotL');
			movm = 3;
			mbwall(3);
		}
		if (k.key=="ArrowRight" || k.keyCode==39){
			$("#cat").removeClass();
			movm = 4;
			mbwall(4);
		}
	});
	function moveT(where){
		if(($("#cat").position()['top']<$("#cat")[0].clientWidth)&&(where==1)){
			where=0;}
		if(((winh-$("#cat").position()['top'])<$("#cat")[0].clientWidth)&&(where==2)){
			where=0;}
		if(($("#cat").position()['left']<$("#cat")[0].clientWidth)&&(where==3)){
			where=0;}
		if((winw-$("#cat").position()['left']<$("#cat")[0].clientWidth)&&(where==4)){
			where=0;}	
		switch(where){
			case 1:$("#cat").animate({top:"-=32"},100);setTimeout(function() {if (movm == 1) {mbwall(1);}},100);break;
			case 2:$("#cat").animate({top:"+=32"},100);setTimeout(function() {if (movm == 2) {mbwall(2);}},100);break;
			case 3:$("#cat").animate({right:"+=32"},100);setTimeout(function() {if (movm == 3) {mbwall(3);}},100);break;
			case 4:$("#cat").animate({right:"-=32"},100);setTimeout(function() {if (movm == 4) {mbwall(4);}},100);break;
			default: $("#cat").effect( "shake",{distance:3, times:1},100);
		}
	}
	function mbwall(where){
		let posX = Math.round($("#cat").position()['left']/32);
		let posY = Math.round($("#cat").position()['top']/32)-1;
		console.log(posX+" "+posY);
		console.log(map[posY][posX]);
		console.log(map[posY-1][posX]);
		console.log(map[posY+1][posX]);
		console.log(map[posY][posX-1]);
		console.log(map[posY][posX+1]);
		console.log(where+"asds");
		switch (where){
			case 1: if (map[posY-1][posX]==1) {moveT(0);}else{moveT(where);} break;
			case 2: if (map[posY+1][posX]==1) {moveT(0);}else{moveT(where);} break;
			case 3: if (map[posY][posX-1]==1) {moveT(0);}else{moveT(where);} break;
			case 4: if (map[posY][posX+1]==1) {moveT(0);}else{moveT(where);} break;
		}
	}
});
</script>
<input type="button" value="Назад" onclick="location.href='../../index.php'"></input>
</body>
</html>