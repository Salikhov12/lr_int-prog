<html>
<head>
<title>
Салихов Рашит. Лабораторная работа №4.
</title>
</head>
<style>
body{
	background: #181818;
}
.FirstForm{
	width: 50%;
	margin: 1% 25% 0%;
	position: relative;
}
.SecondForm{
	width: 50%;
	margin: 1% 25% 5%;
	position: relative;
}
.poster{
	width:28%;
	/*vertical-align: top;display: inline;*/ 
	float:left;
	height:500;
	
}
.imag{
	width:72%;
	/*display: inline;vertical-align: top;*/ 
	float:right;
}
.about{
	display: inline-block;
	width:72%;
}
.bt{
	position: relative;
	margin: 3% 0%;
	height: 50px;
    width: 180;
}
h2{
	margin: 0;
	position:relative;
	top:-15;
}
</style>
<!--Подключение библиотек-->
<!--FancyZoom-->
<link rel="stylesheet" href="../../lib/jquery.fancyzoom-1.0.2/css/fancyzoom.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>var FancyZ = jQuery.noConflict();</script><!--Для использования другой версии jQuery-->
<script src="../../lib/jquery.fancyzoom-1.0.2/js/jquery.fancyzoom.min.js"></script>
<!--jCarousel-->
<script type="text/javascript" src="../../lib/jcarousel-0.3.9/dist/jquery.jcarousel.min.js"></script>
<link rel="stylesheet" type="text/css" href="jcarousel.css" /> 
<!--jQuery-UI-->
<link rel="stylesheet" href="../../lib/jquery-ui-1.13.1.custom/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="../../lib/jquery-ui-1.13.1.custom/jquery-ui.js"></script> 
<!--Подключили-->
<body>
<!--Первая форма-->
<div class="FirstForm" id="tabs">
	<!--Верхние вкладки-->
	<ul>
		<li><a id="a1" href="#tabs-1">Пример 1</a></li>
		<li><a id="a2" href="#tabs-2">Пример 2</a></li>
		<li><a id="a3" href="#tabs-3">Пример 3</a></li>
    </ul>
	<!--Первая вкладка-->
  <div id="tabs-1" style="padding: 2em 0.1em;" aria-hidden="false">
	<div class="poster">
		<a href="../../img/4.1.large.jpg" class="fancy"><img src="../../img/4.2.small.jpg"></a>
		<input type="button" class="bt" id="bt1" value="Купить">
	</div>
	<!--Images-->
	<div class="imag">
	<!--Title-->
	<h2>Название штуки 1</h2>
	<!-- Wrapper -->
	<div class="jcarousel-wrapper" id="jw1">
		<!-- Carousel -->
		<div class="jcarousel" id="jca1">
		<ul>
			<li><a href="../../img/4.2.large.jpg" class="fancy"><img src="../../img/4.2.small.jpg"></a></li>
			<li><a href="../../img/4.4.large.jpg" class="fancy"><img src="../../img/4.4.small.jpg"></a></li>
		</ul>
		</div>
	</div>	
	<!-- Controls -->
	<p class="jcarousel-pagination"></p>	
	</div>
	<!--Text-->
	<div>
		<p class="about">флвофдлыв щфрвш рфыщш грфышщ грвшщгфыр вшгр фшгыр фвыфвфывыфв фывфыв фыв фывфывыфвфыв фывыфвфывыфв ф  выфвфыв фыв фы в фв фывфы вфы вф ыв фыв фы выф вфы в фвыфвыфв</p>
	</div>
  </div>
  <!--Вторая вкладка-->
  <div id="tabs-2" style="padding: 2em 0.1em;" >
	<div class="poster">
		<a href="../../img/4.1.large.jpg" class="fancy"><img src="../../img/4.3.small.jpg"></a>
		<input type="button" class="bt" id="bt2" value="Купить">
	</div>
    <!--Images-->
	<div class="imag">
	<!--Title-->
	<h2>Название штуки 2</h2>
	<!-- Wrapper -->
	<div class="jcarousel-wrapper" id="jw2">
		<!-- Carousel -->
		<div class="jcarousel" id="jca2">
		<ul>
			<li><a href="../../img/4.2.large.jpg" class="fancy"><img src="../../img/5862361.jpg"></a></li>
			<li><a href="../../img/4.3.large.jpg" class="fancy"><img src="../../img/4.3.small.jpg"></a></li>
		</ul>
		</div>
	</div>	
	<!-- Controls -->
	<p class="jcarousel-pagination"></p>	
	</div>
	<!--Text-->
	<div>
		<p class="about">флвофдлыв щфрвш рфыщш грфышщ грвшщгфыр вшгр фшгыр фвыфвфывыфв фывфыв фыв фывфывыфвфыв фывыфвфывыфв ф  выфвфыв фыв фы в фв фывфы вфы вф ыв фыв фы выф вфы в фвыфвыфв</p>
	</div>
  </div>
  <!--Третья вкладка-->
  <div id="tabs-3" style="padding: 2em 0.1em;" >
	<div class="poster">
		<a href="../../img/4.1.large.jpg" class="fancy"><img src="../../img/4.1.small.jpg"></a>
		<input type="button" class="bt" id="bt3" value="Купить">
	</div>
    <!--Images-->
	<div class="imag">
	<!--Title-->
	<h2>Название штуки 3</h2>
	<!-- Wrapper -->
	<div class="jcarousel-wrapper" id="jw3">
		<!-- Carousel -->
		<div class="jcarousel" id="jca3">
		<ul>
			<li><a href="../../img/4.2.large.jpg" class="fancy"><img src="../../img/4.2.small.jpg"></a></li>
			<li><a href="../../img/4.3.large.jpg" class="fancy"><img src="../../img/4.3.small.jpg"></a></li>
		</ul>
		</div>
	</div>	
	<!-- Controls -->
	<p class="jcarousel-pagination"></p>	
	</div>
	<!--Text-->
	<div>
		<p class="about">флвофдлыв щфрвш рфыщш грфышщ грвшщгфыр вшгр фшгыр фвыфвфывыфв фывфыв фыв фывфывыфвфыв фывыфвфывыфв ф  выфвфыв фыв фы в фв фывфы вфы вф ыв фыв фы выф вфы в фвыфвыфв</p>
	</div>
  </div>
</div>
<!--Вторая форма-->
<div class="SecondForm">
	<div>
	123
	</div>
</div>
<script>
(function($){ //Запуск FancyZoom
	$("a.fancy").fancyZoom();
})(FancyZ); 
</script>
</body>
<script>
jQuery.preloadImages = function(){ // Подгрузка изображений в буфер
	for(var i = 0; i < arguments.length; i++)
	{
		jQuery("<img>").attr("src", arguments[ i ]);
	}
};
$.preloadImages("../../img/4.2.small.jpg","../../img/4.3.small.jpg","../../img/4.4.small.jpg","../../img/5862361.jpg");	// Путь к изображениям
$("#a1,#a2,#a3").click(function(){ //При нажатии на вкладку
	var jcIdForAS = $(this)[0].id;
	(function($){ //Останавливается автоскроллинг
		$('.jcarousel').jcarouselAutoscroll('stop');
	})(FancyZ);
	(function($){ //Запускается автоскроллинг выбранной вкладки
		$('#jc'+jcIdForAS).jcarouselAutoscroll('start');
	})(FancyZ);
	$(".SecondForm").hide();
	setTimeout(function() {(function($){ // paging
		$('#pjw'+jcIdForAS.substring(1,2)).animate({top:$(".about:eq("+(jcIdForAS.substring(1,2)-1)+")").position()['top'] - $(".jcarousel-wrapper:eq("+(jcIdForAS.substring(1,2)-1)+")").position()['top']},0);
		//$('#jc'+jcIdForAS).jcarouselAutoscroll('start');
	})(FancyZ);},0);
});
$(window).load(function(){
	(function($){ // Основной код, в котором требуется другая версия jQuery
		$('.jcarousel').on('jcarousel:create', function(event, carousel) { // Установка размеров блока при создании jcarousel
			var jwid = this.parentElement.id;
			$("#"+jwid).animate({height:maxHeightOfImage(parseInt(jwid.substring(2,3))),width:maxWidthOfImage(parseInt(jwid.substring(2,3)))},0);
		});
		$('.jcarousel').on('jcarousel:visiblein', 'li', function(event, carousel) { // Установка размеров блока, когда изображение становится видимым
			var hid = this.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("aria-hidden");
			var jwid = this.parentElement.parentElement.parentElement.id;
			if ((hid!="true") && (!!hid)){	// Если атрибут вкладки "видимый" и этот атрибут существует
				let clH = this.clientHeight;
				let clW = this.clientWidth;
				$("#"+jwid).animate({height:clH,width:clW},{duration:400, start:function(){
					$('#p'+jwid).animate({top:clH},400);}});
			}
		});
		$('.jcarousel').jcarousel({wrap: 'circular'}); // Карусель будет циклична
		$('.jcarousel-pagination').jcarouselPagination({ // Создание кнопок для выбора изображения
			item: function itemfun(page, carouselItems) {
				$('.jcarousel-pagination')[this['_carousel'][0].parentElement.id.substring(2,3)-1].id= 'p'+this['_carousel'][0].parentElement.id;
				let pjwid = $('.jcarousel-pagination')[this['_carousel'][0].parentElement.id.substring(2,3)-1].id;
				$('#'+pjwid).animate({top:$(".jcarousel-wrapper:eq("+(pjwid.substring(3,4)-1)+")").position()['top']},0);
				if (page==1){return '<a href="#' +this['_carousel'][0].parentElement.id+page + '"class="active">' + page + '</a>';} // Установка кнопки "нажатой", если изображение - первое
				return '<a href="#' +this['_carousel'][0].parentElement.id+page +'">' + page + '</a>';
		  }
		});
		$('.jcarousel').jcarouselAutoscroll({ // Настройки автоскролла изображений
		  interval: 3000,
		  target: '+=1',
		  autostart: false,
		  auto: 2
		});
		$('#jca1').jcarouselAutoscroll('start'); // Запуск автоскролла на первой вкладке
		$('.jcarousel-pagination').on('jcarouselpagination:active', 'a', function() { // При становлении кнопки "нажатой"
			let elem = $(this)[0].parentElement.parentElement.parentElement;
			if (elem.getAttribute("aria-hidden")=="false"){
				$(this).addClass('active');
			}
		});
		$('.jcarousel-pagination').on('jcarouselpagination:inactive', 'a', function() { // При становлении кнопки "отжатой"
			let elem = $(this)[0].parentElement.parentElement.parentElement;
			if (elem.getAttribute("aria-hidden")=="false"){
				$(this).removeClass('active');
			}
		});
	})(FancyZ); 
	$(function(){ //Отображение панели вкладок
		$("#tabs").tabs();
		$(".SecondForm").attr('class',$("#tabs-1").attr('class')+" SecondForm"); // Добавление стиля jQuery-UI
	});
	function maxHeightOfImage(id){
		let h = 0;
		let im = $("div #jca"+id+" ul li img");
		for (let i = 0; i<im.length;i++){ if (im[i].clientHeight>h){h = im[i].clientHeight;}}
		$(".jcarousel-pagination")[id-1].style.margin = 0;
		$(".jcarousel-pagination")[id-1].style.left = $(".jcarousel-wrapper").position()['left']-30;
		return h;
	}
	function maxWidthOfImage(id){
		let w = 0;
		let im = $("div #jca"+id+" ul li img");
		for (let i = 0; i<im.length;i++){ if (im[i].clientWidth>w){w = im[i].clientWidth;}}
		return w;
	}
});
$(".poster").ready(function(){
	let posIm = $(".poster img");
	let pos = $(".poster");
	let bt = $(".bt");
	for (let i = 0;i<posIm.length;i++){
		posIm[i].style.position = "relative";
		let p = (1-(posIm[i].clientWidth/pos[i].clientWidth))/2;
		posIm[i].style.left = p*100+"%";
		bt[i].style.left = p*100+"%";
	}
});
$(function(){
	$(".SecondForm").hide();
	$(".bt").click(function(){
		if ($(".SecondForm").is(":hidden")){
			$(".SecondForm").show(400);
		}
		else{$(".SecondForm").hide(400);}
			for (let i = 1;i<=3;i++){
				let ahid = $("#tabs-"+i)[0].getAttribute("aria-hidden");
				if ((ahid!="true") && (!!ahid)){	// Если атрибут вкладки "видимый" и этот атрибут существует
					$(".poster")[i-1].style.height = $(".SecondForm").position()['top'] - $(".poster:eq("+(i-1)+")").position()['top'] - 20;
				}
			}
		}
		
	);
	$(".poster").ready(function(){ // Ширина кнопки "Купить"
		for (let i = 0; i<3; i++){
			$("div .poster input")[i].style.width = $("div .poster img")[i].clientWidth;
		}
	});
	
});
</script>
</html>