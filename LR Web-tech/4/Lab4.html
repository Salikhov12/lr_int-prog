<html>
<head>
<title>
Салихов Рашит. Лабораторная работа №4.
</title>
</head>
<style>
body{
	background: #181818;
}
.FirstForm{
	width: 50%;
	margin: 1% 25% 0%;
	position: relative;
}
@media (max-width:1540px){
	.FirstForm{
		width: 90%;
		margin: 3% 4% 5%;
		position: relative;
	}
}
.SecondForm{
	width: 50%;
	margin: 1% 25% 5%;
	position: sticky;
	bottom: 0px;
}
.poster{
	width:28%;
	float:left;
	height:500;
	overflow: visible;
}
.imag{
	width:72%;
	float:right;
}
.about{
	display: inline-block;
	width:72%;
}
.bt{
	position: relative;
	margin: 3% 0%;
	height: 50px;
    width: 180;
}
h2{
	margin: 0;
	position:relative;
	top:-15;
}
.select{
	margin:10 50 30;
}
label {
	font-size:17;
}
input {
	font-size:17;
}
span {
	font-size:17;
}
img {
	cursor: zoom-in;
}
</style>
<!--Подключение библиотек-->
<!--FancyZoom-->
<link rel="stylesheet" href="../../lib/jquery.fancyzoom-1.0.2/css/fancyzoom.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>var FancyZ = jQuery.noConflict();</script><!--Для использования другой версии jQuery-->
<script src="../../lib/jquery.fancyzoom-1.0.2/js/jquery.fancyzoom.min.js"></script>
<!--jCarousel-->
<script type="text/javascript" src="../../lib/jcarousel-0.3.9/dist/jquery.jcarousel.min.js"></script>
<link rel="stylesheet" type="text/css" href="jcarousel.css" /> 
<!--jQuery-UI-->
<link rel="stylesheet" href="../../lib/jquery-ui-1.13.1.custom/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="../../lib/jquery-ui-1.13.1.custom/jquery-ui.js"></script> 
<script type="text/javascript" src="../../lib/datepicker-ru.js"></script><!--Локализация календаря-->
<!--Подключили-->
<body>
<!--Первая форма-->
<div class="FirstForm" id="tabs">
	<!--Верхние вкладки-->
	<ul>
		<li><a id="a1" href="#tabs-1">POÄNG ПОЭНГ</a></li>
		<li><a id="a2" href="#tabs-2">STRANDMON СТРАНДМОН</a></li>
		<li><a id="a3" href="#tabs-3">VIMLE ВИМЛЕ</a></li>
    </ul>
	<!--Первая вкладка-->
  <div id="tabs-1" style="padding: 2em 0.1em;" aria-hidden="false">
	<div class="poster">
		<a href="../../img/4.10.large.jpg" class="fancy"><img src="../../img/4.10.min.jpg"></a>
		<input type="button" class="bt" id="bt1" value="Купить">
	</div>
	<!--Images-->
	<div class="imag">
	<!--Title-->
	<h2>POÄNG ПОЭНГ</h2>
	<!-- Wrapper -->
	<div class="jcarousel-wrapper" id="jw1">
		<!-- Carousel -->
		<div class="jcarousel" id="jca1">
		<ul>
			<li><a href="../../img/4.11.large.jpg" class="fancy"><img src="../../img/4.11.min.jpg"></a></li>
			<li><a href="../../img/4.12.large.jpg" class="fancy"><img src="../../img/4.12.min.jpg"></a></li>
			<li><a href="../../img/4.13.large.jpg" class="fancy"><img src="../../img/4.13.min.jpg"></a></li>
		</ul>
		</div>
	</div>	
	<!-- Controls -->
	<p class="jcarousel-pagination"></p>	
	</div>
	<!--Text-->
	<div>
		<p class="about">Кресло-качалка, дубовый шпон, беленый/Глосе белый с оттенком. Мягкая прочная и простая в уходе кожаная обивка – практичное решение для семей с детьми. Высокая спинка обеспечивает хорошую опору для шеи. Многослойный изогнутый деревянный каркас придает креслу дополнительную упругость. Оно просто создано для идеального отдыха.</p>
	</div>
  </div>
  <!--Вторая вкладка-->
  <div id="tabs-2" style="padding: 2em 0.1em;" >
	<div class="poster">
		<a href="../../img/4.20.large.jpg" class="fancy"><img src="../../img/4.20.min.jpg"></a>
		<input type="button" class="bt" id="bt2" value="Купить">
	</div>
    <!--Images-->
	<div class="imag">
	<!--Title-->
	<h2>STRANDMON СТРАНДМОН</h2>
	<!-- Wrapper -->
	<div class="jcarousel-wrapper" id="jw2">
		<!-- Carousel -->
		<div class="jcarousel" id="jca2">
		<ul>
			<li><a href="../../img/4.21.large.jpg" class="fancy"><img src="../../img/4.21.min.jpg"></a></li>
			<li><a href="../../img/4.22.large.jpg" class="fancy"><img src="../../img/4.22.min.jpg"></a></li>
			<li><a href="../../img/4.23.large.jpg" class="fancy"><img src="../../img/4.23.min.jpg"></a></li>
			<li><a href="../../img/4.24.large.jpg" class="fancy"><img src="../../img/4.24.min.jpg"></a></li>
		</ul>
		</div>
	</div>	
	<!-- Controls -->
	<p class="jcarousel-pagination"></p>	
	</div>
	<!--Text-->
	<div>
		<p class="about">Кресло с табуретом для ног, Гранн/Бумстад темно-коричневый. Для контактных поверхностей использована мягкая, гладкая и прочная кожаная обивка ГРАНН. Обивка БУМСТАД для остальных поверхностей изготовлена из ткани, которая по внешнему виду и на ощупь неотличима от натуральной кожи. Благодаря защитному покрытию мебель устойчива к воздействие солнечного света, жидкостей, к загрязнениям и появлению царапин, чем кожа с легким покрытием или без покрытия.</p>
	</div>
  </div>
  <!--Третья вкладка-->
  <div id="tabs-3" style="padding: 2em 0.1em;" >
	<div class="poster">
		<a href="../../img/4.30.large.jpg" class="fancy"><img src="../../img/4.30.min.jpg"></a>
		<input type="button" class="bt" id="bt3" value="Купить">
	</div>
    <!--Images-->
	<div class="imag">
	<!--Title-->
	<h2>VIMLE ВИМЛЕ</h2>
	<!-- Wrapper -->
	<div class="jcarousel-wrapper" id="jw3">
		<!-- Carousel -->
		<div class="jcarousel" id="jca3">
		<ul>
			<li><a href="../../img/4.31.large.jpg" class="fancy"><img src="../../img/4.31.min.jpg"></a></li>
			<li><a href="../../img/4.32.large.jpg" class="fancy"><img src="../../img/4.32.min.jpg"></a></li>
		</ul>
		</div>
	</div>	
	<!-- Controls -->
	<p class="jcarousel-pagination"></p>	
	</div>
	<!--Text-->
	<div>
		<p class="about">Кресло, Гранн/Бумстад черный. Для контактных поверхностей использована мягкая, гладкая и прочная кожаная обивка ГРАНН. Обивка БУМСТАД для остальных поверхностей изготовлена из ткани, которая по внешнему виду и на ощупь неотличима от натуральной кожи. Простой уход – достаточно протереть влажной тканью.</p>
	</div>
  </div>
</div>
<!--Вторая форма-->
<div class="SecondForm">
	<div id="dialog" title="Оформление заказа">
		<b id="buyEl" style="margin:10 20 0;font-size:17;"></b>
		<p id="price" style="margin:0 20 10;font-size:17;"></p>
		<label for ="init" style="margin:0 5 10 20;">ФИО:</label>
		<input type="text" size="30" id="init"><br><br>
		<label for ="kol" style="margin:0 5 10 20;">Количество:</label>
		<input type="number" value="0" step="1" min="0" max="99" id="kol">
		<div id="slider" style="margin:10 50 30;"></div>
		<label for ="data" style="margin:0 5 10 20;">На какую дату:</label>
		<input id="data" readonly><br><br>
		<label for ="select" style="margin:0 5 10 20;">Город:</label>
		<select id="select" >
			<option>Москва</option>
			<option>Санкт-Петербург</option>
			<option>Казань</option>
			<option>Уфа</option>
		</select>
		<br><label for ="search" style="margin:0 5 10 20;">Улица:</label>
		<input type="text" style="margin:20 0 0 0;" id="search">
		<label for ="home" style="margin:0 5 10 20;">Дом:</label>
		<input type="text" style="margin:20 0 0 0;" size="2" maxlength="2" id="home"><br><br>
		<label for ="promo" style="margin:0 5 10 20;">Промокод:</label>
		<input type="text" size="10" id="promo">
		<a href="#" title="Промокод - Pro10">?</a><br><br>
		<label for ="summ" step="0.01" style="margin:0 5 10 20;">Итого:</label>
		<input type="number" min="0" id="summ" value="0.00" readonly><span> рублей</span><br><br>
		<input type="button" id="buy" value="Оформить" style="position:relative;width: 20%;	margin: 3% 40% 2%;height:50;">
	</div>
	<div id="confirm" title="Подтверждение">
		<p>Вы уверены в оформлении заказа?</p>
	</div>
	<div id="alert" title="Заказ оформлен">
		<p>Спасибо, заказ оформлен.</p>
	</div>
</div>
<script>
(function($){ //Запуск FancyZoom
	$("a.fancy").fancyZoom();
})(FancyZ); 
</script>
</body>
<script>
jQuery.preloadImages = function(){ // Подгрузка изображений в буфер
	for(var i = 0; i < arguments.length; i++)
	{
		jQuery("<img>").attr("src", arguments[ i ]);
	}
};
$.preloadImages("../../img/4.10.min.jpg","../../img/4.20.min.jpg","../../img/4.30.min.jpg","../../img/4.11.min.jpg","../../img/4.12.min.jpg","../../img/4.13.min.jpg",);	// Путь к изображениям
$("#a1,#a2,#a3").click(function(){ //При нажатии на вкладку
	var jcIdForAS = $(this)[0].id;
	(function($){ //Останавливается автоскроллинг
		$('.jcarousel').jcarouselAutoscroll('stop');
	})(FancyZ);
	(function($){ //Запускается автоскроллинг выбранной вкладки
		$('#jc'+jcIdForAS).jcarouselAutoscroll('start');
	})(FancyZ);
	setTimeout(function() {(function($){ // paging
		$('#pjw'+jcIdForAS.substring(1,2)).animate({top:$(".about:eq("+(jcIdForAS.substring(1,2)-1)+")").position()['top'] - $(".jcarousel-wrapper:eq("+(jcIdForAS.substring(1,2)-1)+")").position()['top']},0);
	})(FancyZ);},0);
});
$(window).load(function(){
	(function($){ // Основной код, в котором требуется другая версия jQuery
		$('.jcarousel').on('jcarousel:create', function(event, carousel) { // Установка размеров блока при создании jcarousel
			var jwid = this.parentElement.id;
			let clH = this.clientHeight;
			let clW = this.clientWidth;
			$("#"+jwid).animate({height:maxHeightOfImage(parseInt(jwid.substring(2,3))),width:maxWidthOfImage(parseInt(jwid.substring(2,3)))},0);
			setTimeout(function() {
				$('#p'+jwid).animate({top:clH},{duration:0});
			},0);
			if (($(".poster img:eq("+(jwid.substring(2,3)-1)+")")[0].clientHeight + 50)<(clH+$(".about:eq("+(jwid.substring(2,3)-1)+")")[0].clientHeight)){
				$(".poster:eq("+(jwid.substring(2,3)-1)+")").animate({height:clH+$(".about:eq("+(jwid.substring(2,3)-1)+")")[0].clientHeight+50},400);}
			else{$(".poster:eq("+(jwid.substring(2,3)-1)+")").animate({height:($(".poster img:eq("+(jwid.substring(2,3)-1)+")")[0].clientHeight + 100)},400);}
		});
		$('.jcarousel').on('jcarousel:visiblein', 'li', function(event, carousel) { // Установка размеров блока, когда изображение становится видимым
			var hid = this.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("aria-hidden");
			var jwid = this.parentElement.parentElement.parentElement.id;
			if ((hid!="true") && (!!hid)){	// Если атрибут вкладки "видимый" и этот атрибут существует
				let clH = this.clientHeight;
				let clW = this.clientWidth;
				$("#"+jwid).animate({height:clH,width:clW},{duration:400, start:function(){
					$('#p'+jwid).animate({top:clH},{duration:400, start:function(){
						if (($(".poster img:eq("+(jwid.substring(2,3)-1)+")")[0].clientHeight + 50)<(clH+$(".about:eq("+(jwid.substring(2,3)-1)+")")[0].clientHeight)){
						$(".poster:eq("+(jwid.substring(2,3)-1)+")").animate({height:clH+$(".about:eq("+(jwid.substring(2,3)-1)+")")[0].clientHeight},400);}
					}});}});
			}
		});
		$('.jcarousel').jcarousel({wrap: 'circular'}); // Карусель будет циклична
		$('.jcarousel-pagination').jcarouselPagination({ // Создание кнопок для выбора изображения
			item: function itemfun(page, carouselItems) {
				$('.jcarousel-pagination')[this['_carousel'][0].parentElement.id.substring(2,3)-1].id= 'p'+this['_carousel'][0].parentElement.id;
				let pjwid = $('.jcarousel-pagination')[this['_carousel'][0].parentElement.id.substring(2,3)-1].id;
				$('#'+pjwid).animate({top:$(".jcarousel-wrapper:eq("+(pjwid.substring(3,4)-1)+")").position()['top']},0);
				if (page==1){return '<a href="#' +this['_carousel'][0].parentElement.id+page + '"class="active">' + page + '</a>';} // Установка кнопки "нажатой", если изображение - первое
				return '<a href="#' +this['_carousel'][0].parentElement.id+page +'">' + page + '</a>';
		  }
		});
		$('.jcarousel').jcarouselAutoscroll({ // Настройки автоскролла изображений
		  interval: 3000,
		  target: '+=1',
		  autostart: false,
		  auto: 2
		});
		$('#jca1').jcarouselAutoscroll('start'); // Запуск автоскролла на первой вкладке
		$('.jcarousel-pagination').on('jcarouselpagination:active', 'a', function() { // При становлении кнопки "нажатой"
			let elem = $(this)[0].parentElement.parentElement.parentElement;
			if (elem.getAttribute("aria-hidden")=="false"){
				$(this).addClass('active');
			}
		});
		$('.jcarousel-pagination').on('jcarouselpagination:inactive', 'a', function() { // При становлении кнопки "отжатой"
			let elem = $(this)[0].parentElement.parentElement.parentElement;
			if (elem.getAttribute("aria-hidden")=="false"){
				$(this).removeClass('active');
			}
		});
	})(FancyZ); 
	$(function(){ // Отображение панели вкладок
		$("#tabs").tabs();
	});
	function maxHeightOfImage(id){
		let h = 0;
		let im = $("div #jca"+id+" ul li img");
		for (let i = 0; i<im.length;i++){ if (im[i].clientHeight>h){h = im[i].clientHeight;}}
		$(".jcarousel-pagination")[id-1].style.margin = 0;
		$(".jcarousel-pagination")[id-1].style.left = $(".jcarousel-wrapper").position()['left']-30;
		return h;
	}
	function maxWidthOfImage(id){
		let w = 0;
		let im = $("div #jca"+id+" ul li img");
		for (let i = 0; i<im.length;i++){ if (im[i].clientWidth>w){w = im[i].clientWidth;}}
		return w;
	}
});
$(".poster").ready(function(){ // Установка расположение постера и кнопки
	let posIm = $(".poster img");
	let pos = $(".poster");
	let bt = $(".bt");
	setTimeout(function() {
		for (let i = 0;i<posIm.length;i++){
			posIm[i].style.position = "relative";
			let p = (1-(posIm[i].clientWidth/pos[i].clientWidth))/2;
			posIm[i].style.left = p*100+"%";
			bt[i].style.left = p*100+"%";
		}
	},0);
});
$(function(){
	var price = 0;
	var prom = 1;
	var city = 'Москва';
	var availableTags = ["Никольская","Большая Дмитровка", "Кузнецкий Мост", "Столешников", "Камергерский переулок","Театральный проезд","Охотный ряд","Вознесенский переулок"];
	$('#dialog').dialog({
		autoOpen: false,
		minWidth: 550,
		minHeight: 590,
		close: function( event, ui ) {clear();},
		hide: { effect: "fade", duration: 200 },
		show: { effect: "fade", duration: 200 } 
	});
	$('#confirm').dialog({
		autoOpen: false,
		hide: { effect: "fade", duration: 200 },
		show: { effect: "fade", duration: 200 },
		buttons: [{text: "Да", click: function() {$('#alert').dialog('open');}},
                  {text: "Нет", click: function() {$(this).dialog("close")}}]		
	});
	$('#alert').dialog({
		autoOpen: false,
		hide: { effect: "fade", duration: 200 },
		show: { effect: "fade", duration: 200 },
		buttons: [{text: "Ок", click: function() {$('#alert').dialog('close');$('#confirm').dialog('close');$('#dialog').dialog('close');}}]
	});
	$(".bt").click(function(){ // Нажатие на кнопку
		for (let i = 1;i<=3;i++){
			let ahid = $("#tabs-"+i)[0].getAttribute("aria-hidden");
			if ((ahid!="true") && (!!ahid)){	// Если атрибут вкладки "видимый" и этот атрибут существует
				$("#buyEl").text($("h2:eq("+(i-1)+")").text());
				$("#price").text("Цена: "+Price(i-1)+" руб.");
				price = Price(i-1);
			}
		}
		$('#dialog').dialog('open');
	});
	$(".poster").ready(function(){ // Ширина кнопки "Купить"
		setTimeout(function() {
			for (let i = 0; i<3; i++){
				$("div .poster input")[i].style.width = $("div .poster img")[i].clientWidth;
			}
		},0);
	});
	function Price(x) { //Цена
		switch(x){
			case 0: return 18499;
			case 1: return 41998;
			case 2: return 39999;
			default: return 999;
		}
	}
	$('#slider').slider({
		animate: 'fast',
		min: 0,
		max: 99,
		value: 0,
		slide: function( event, ui ) {
			$('#kol').val(ui['value']);
			$('#summ').val((ui['value']*price*prom).toFixed(2));
		}
	});
	$("#kol").change(function(){
		if ($(this).val()>99){$(this).val(99)}
		if ($(this).val()<0){$(this).val(0)}
		$('#slider').slider('value',$(this).val());
		$('#summ').val(($(this).val()*price*prom).toFixed(2));
	});
	$("#data").datepicker({
		minDate: 1
	});
	$("#data").datepicker($.datepicker.regional["ru"]);
	var cityM = [
      "Никольская","Большая Дмитровка", "Кузнецкий Мост", "Столешников", "Камергерский переулок","Театральный проезд","Охотный ряд","Вознесенский переулок"
    ];
	var cityS = [
      "Петровская набережная","Миллионная","Невский проспект","Набережная реки Фонтанки","Малая Конюшенная","Итальянская","Гороховая","Садовая"
    ];
	var cityK = [
      "Дзержинского","Московская","Кремлевская","Островского","Рихарда Зорге","Пушкина","Саид-Галеева","Баумана"
    ];
	var cityU = [
      "Революционная","Ленина","Достоевского","Посадская","Карла Маркса","Менделеева","Комсомольская","Зорге"
    ];
	$("#select").selectmenu({
		change: function( event, data ) {
			city = data.item.value;
			switch(data.item.index){
				case 0:availableTags = cityM;break;
				case 1:availableTags = cityS;break;
				case 2:availableTags = cityK;break;
				case 3:availableTags = cityU;break;
			}
			console.log(data);
		}
	});
	$("#search").focusin(function(){
		$( "#search" ).autocomplete({
			source: availableTags, minLength: 3
		});
	});
    
	$("#promo").change(function(){
		if ($(this).val()=="Pro10"){prom = 0.9;$('#summ').val(($("#kol").val()*price*prom).toFixed(2));}
		else {prom = 1;$('#summ').val(($("#kol").val()*price*prom).toFixed(2));}
	});
	$(".SecondForm div a").tooltip();
	$('#buy').click(function(){
		// Проверка введенных данных
		let ok = true;
		if ($("#init").val().length<5){ok = false;$("#init").effect( "shake",{distance:7, times:1},200);}
		if ($("#kol").val().length<1 || $("#kol").val()=="0"){ok = false;$("#kol").effect( "shake",{distance:7, times:1},200);}
		if ($("#data").val().length<10){ok = false;$("#data").effect( "shake",{distance:7, times:1},200);}
		if ($("#search").val().length<5){ok = false;$("#search").effect( "shake",{distance:7, times:1},200);}
		if ($("#home").val().length<1){ok = false;$("#home").effect( "shake",{distance:7, times:1},200);}
		if (ok){$('#confirm').dialog('open');}
	});
	function clear(){
		$("input:not(.bt, #buy)").val('');
		$("#kol").val('0');
		$("#summ").val('0.00');
		$('#slider').slider('value',0);
	}
});
</script>
</html>